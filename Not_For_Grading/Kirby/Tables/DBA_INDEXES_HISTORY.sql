TRUNCATE TABLE CAPSTONE_DEMO.DBA_INDEXES_HISTORY;
DROP TABLE CAPSTONE_DEMO.DBA_INDEXES_HISTORY;
CREATE TABLE CAPSTONE_DEMO.DBA_INDEXES_HISTORY

(
SNAPSHOT_TS TIMESTAMP,
OWNER VARCHAR2(128),
INDEX_NAME VARCHAR2(128),
INDEX_TYPE VARCHAR2(27),
TABLE_OWNER VARCHAR2(128),
TABLE_NAME VARCHAR2(128),
TABLE_TYPE VARCHAR2(11),
UNIQUENESS VARCHAR2(9),
COMPRESSION VARCHAR2(13),
PREFIX_LENGTH NUMBER,
TABLESPACE_NAME VARCHAR2(30),
INI_TRANS NUMBER,
MAX_TRANS NUMBER,
INITIAL_EXTENT NUMBER,
NEXT_EXTENT NUMBER,
MIN_EXTENTS NUMBER,
MAX_EXTENTS NUMBER,
PCT_INCREASE NUMBER,
PCT_THRESHOLD NUMBER,
INCLUDE_COLUMN NUMBER,
FREELISTS NUMBER,
FREELIST_GROUPS NUMBER,
PCT_FREE NUMBER,
LOGGING VARCHAR2(3),
BLEVEL NUMBER,
LEAF_BLOCKS NUMBER,
DISTINCT_KEYS NUMBER,
AVG_LEAF_BLOCKS_PER_KEY NUMBER,
AVG_DATA_BLOCKS_PER_KEY NUMBER,
CLUSTERING_FACTOR NUMBER,
STATUS VARCHAR2(8),
NUM_ROWS NUMBER,
SAMPLE_SIZE NUMBER,
LAST_ANALYZED DATE,
DEGREE VARCHAR2(40),
INSTANCES VARCHAR2(40),
PARTITIONED VARCHAR2(3),
TEMPORARY VARCHAR2(1),
GENERATED VARCHAR2(1),
SECONDARY VARCHAR2(1),
BUFFER_POOL VARCHAR2(7),
FLASH_CACHE VARCHAR2(7),
CELL_FLASH_CACHE VARCHAR2(7),
USER_STATS VARCHAR2(3),
DURATION VARCHAR2(15),
PCT_DIRECT_ACCESS NUMBER,
ITYP_OWNER VARCHAR2(128),
ITYP_NAME VARCHAR2(128),
PARAMETERS VARCHAR2(1000),
GLOBAL_STATS VARCHAR2(3),
DOMIDX_STATUS VARCHAR2(12),
DOMIDX_OPSTATUS VARCHAR2(6),
FUNCIDX_STATUS VARCHAR2(8),
JOIN_INDEX VARCHAR2(3),
IOT_REDUNDANT_PKEY_ELIM VARCHAR2(3),
DROPPED VARCHAR2(3),
VISIBILITY VARCHAR2(9),
DOMIDX_MANAGEMENT VARCHAR2(14),
SEGMENT_CREATED VARCHAR2(3),
ORPHANED_ENTRIES VARCHAR2(3),
INDEXING VARCHAR2(7)
);

INSERT INTO CAPSTONE_DEMO.DBA_INDEXES_HISTORY

SELECT
  SYSTIMESTAMP AS SNAPSHOT_TS,
  A.OWNER,
  A.INDEX_NAME,
  A.INDEX_TYPE,
  A.TABLE_OWNER,
  A.TABLE_NAME,
  A.TABLE_TYPE,
  A.UNIQUENESS,
  A.COMPRESSION,
  A.PREFIX_LENGTH,
  A.TABLESPACE_NAME,
  A.INI_TRANS,
  A.MAX_TRANS,
  A.INITIAL_EXTENT,
  A.NEXT_EXTENT,
  A.MIN_EXTENTS,
  A.MAX_EXTENTS,
  A.PCT_INCREASE,
  A.PCT_THRESHOLD,
  A.INCLUDE_COLUMN,
  A.FREELISTS,
  A.FREELIST_GROUPS,
  A.PCT_FREE,
  A.LOGGING,
  A.BLEVEL,
  A.LEAF_BLOCKS,
  A.DISTINCT_KEYS,
  A.AVG_LEAF_BLOCKS_PER_KEY,
  A.AVG_DATA_BLOCKS_PER_KEY,
  A.CLUSTERING_FACTOR,
  A.STATUS,
  A.NUM_ROWS,
  A.SAMPLE_SIZE,
  A.LAST_ANALYZED,
  A.DEGREE,
  A.INSTANCES,
  A.PARTITIONED,
  A.TEMPORARY,
  A.GENERATED,
  A.SECONDARY,
  A.BUFFER_POOL,
  A.FLASH_CACHE,
  A.CELL_FLASH_CACHE,
  A.USER_STATS,
  A.DURATION,
  A.PCT_DIRECT_ACCESS,
  A.ITYP_OWNER,
  A.ITYP_NAME,
  A.PARAMETERS,
  A.GLOBAL_STATS,
  A.DOMIDX_STATUS,
  A.DOMIDX_OPSTATUS,
  A.FUNCIDX_STATUS,
  A.JOIN_INDEX,
  A.IOT_REDUNDANT_PKEY_ELIM,
  A.DROPPED,
  A.VISIBILITY,
  A.DOMIDX_MANAGEMENT,
  A.SEGMENT_CREATED,
  A.ORPHANED_ENTRIES,
  A.INDEXING
FROM DBA_INDEXES A
WHERE OWNER = 'CAPSTONE_DEMO';

COMMIT;