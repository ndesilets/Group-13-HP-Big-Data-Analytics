ALTER SESSION SET CONTAINER = DBCAP;
ALTER SYSTEM SET PARALLEL_DEGREE_POLICY = AUTO SCOPE=SPFILE;
ALTER SESSION SET CONTAINER = CDB$ROOT;
ALTER SYSTEM SET PARALLEL_DEGREE_POLICY = AUTO SCOPE=SPFILE;
ALTER SYSTEM SET DB_BIG_TABLE_CACHE_PERCENT_TARGET = 0 SCOPE=SPFILE;
ALTER SYSTEM SET DB_CACHE_SIZE = 32G SCOPE=SPFILE;
ALTER SYSTEM SET INMEMORY_SIZE = 192G SCOPE=SPFILE;
ALTER SYSTEM SET INMEMORY_MAX_POPULATE_SERVERS=64 SCOPE=SPFILE;
STARTUP FORCE;
ALTER PLUGGABLE DATABASE DBCAP OPEN;
ALTER SESSION SET CONTAINER = DBCAP;

-----------------------------------------------------------
-- QUERY LOW
-----------------------------------------------------------
ALTER TABLE CAPSTONE_DEMO.CAPSTONE_PARALLEL_TEST_V1 INMEMORY MEMCOMPRESS FOR QUERY LOW PRIORITY CRITICAL;
ALTER TABLE CAPSTONE_DEMO.LEAD_LAG_TEST_V1          INMEMORY MEMCOMPRESS FOR QUERY LOW PRIORITY CRITICAL;
ALTER TABLE CAPSTONE_DEMO.PARENT_TABLE_V1           INMEMORY MEMCOMPRESS FOR QUERY LOW PRIORITY CRITICAL;
ALTER TABLE CAPSTONE_DEMO.CHILD_TABLE_V1            INMEMORY MEMCOMPRESS FOR QUERY LOW PRIORITY CRITICAL;

EXECUTE CAPSTONE_DEMO.RESOURCE_MONITOR.PARAMETERS_HISTORY_INSERT;

DECLARE
    populated boolean := false;
    completed number := 0;
BEGIN
    WHILE populated != true
    LOOP
        SELECT
            COUNT(*)
        INTO
            completed
        FROM V$IM_SEGMENTS
        WHERE POPULATE_STATUS = 'COMPLETED';

        IF completed = 4 THEN
            populated := true;
        END IF;

        DBMS_LOCK.SLEEP(SECONDS => 30);
    END LOOP;
END;
/

